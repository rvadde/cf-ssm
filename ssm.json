{
  "schemaVersion": "0.3",
  "description": "Returns content of root directory of instances with the given tag key and value",
  "parameters": {
    "key": {
      "type": "String",
      "description": "Tag key"
    },
    "value": {
      "type": "String",
      "description": "Tag value"
    }
  },
  "mainSteps": [
    {
      "name": "InvokeLambda",
      "action": "aws:invokeLambdaFunction",
      "onFailure": "Abort",
      "inputs": {
        "FunctionName": "GetInstanceIds",
        "Payload": "{ \"key\": \"{{ key }}\", \"value\": \"{{ value }}\" }"
      }
    },
    {
      "name": "ListRoot",
      "action": "aws:runCommand",
      "inputs": {
        "DocumentName": "AWS-RunShellScript",
        "Targets": [
          {
            "Key": "tag:{{ key }}",
            "Values": [
              "{{ value }}"
            ]
          }
        ],
        "Parameters": {
          "workingDirectory": "/",
          "commands": ["ls -al"]
        }
      }
    }
  ],
  "outputs": [
    "ListRoot.CommandId", "ListRoot.Output"
  ]
}
